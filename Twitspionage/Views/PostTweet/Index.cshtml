@using Twitspionage.Models
@model Twitspionage.Models.MysteryDetail
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Tweet clue</h3>

<div class="hidden">
    <span id="currentLat"></span>
    <span id="currentLon"></span>
</div>

@using (Html.BeginForm())
{
    <div id="mystery">
        @Html.AntiForgeryToken()
        @foreach (var clueDetail in Model.Clues)
        {
            Html.RenderPartial("_Tweet", clueDetail);
        }
    </div>
    @Html.ActionLink("Add", "NewClueDetail", null, new {id = "addItem", @class = "mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"})
    <input class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" type="submit" value="Tweet"/>
}

<script type="text/javascript">
    if (navigator != null && navigator.geolocation != null) {
        navigator.geolocation.getCurrentPosition(function(position) {
                $('#currentLat').html(position.coords.latitude);
                $('#currentLon').html(position.coords.longitude);
            },
            function(position) {
                console.log('Error getting location: ' + position.code);
            });
    }
    $("#addItem")
        .click(function() {
            $.ajax({
                url: this.href,
                cache: false,
                success: function (html) {
                    $("#mystery").append(html);
                    setupFields();
                }
            });
            return false;
        });

    function setupFields() {
        var elements = $(".deleteRow");
        elements.length > 1 ? elements.show() : elements.hide();
        elements
            .click(function() {
                $(this).parents("fieldset:first").remove();
                setupFields();
                return false;
            });
        if (componentHandler != null) {
            componentHandler.upgradeAllRegistered();
        }
    }
</script>